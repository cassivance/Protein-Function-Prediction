---
title: "Null Distribution Histogram"
author: "Julia Craft"
date: "April 4, 2018"
output: html_document
---

**anything in all caps needs to be replaced with the appropriate data**

## Load libraries

```{r}
#install.packages("qqman")
library(ggplot2)
library(readr)
library(dplyr)
library(qqman)
```

## Parse data 

```{r}
NullEvalues <- read_tsv("outputRand2.txt")
Evalues <- read_tsv("outputCandida.txt")
```

## Plot data

```{r}
#Give column names to the null and relative data frames
colnames(Evalues) <- c("qseqid", "sseqid", "pident", "length", "mismatch", "gapopen","qstart", "qend", "sstart", "send", "evalue", "bitscore")
colnames(NullEvalues) <- c("qseqid", "sseqid", "pident", "length", "mismatch", "gapopen","qstart", "qend", "sstart", "send", "evalue", "bitscore")

#order the data frames from smallest to largest evalues
Evalues <- arrange(Evalues, evalue)
NullEvalues <- arrange(NullEvalues, evalue)

nrow(Evalues)
nrow(NullEvalues)

cols <- c("null"="#f04546","relative"="#3591d1")
ggplot() + 
    geom_histogram(data=Evalues, aes(Evalues$evalue, fill="relative") , alpha = .3) +
    geom_histogram(data=NullEvalues, aes(NullEvalues$evalue, fill="null"), alpha = .3) +
    labs(title="Null Distribution and Alignment of Candida and Relative Sequences", x="E-value", y="Count")+
    scale_colour_manual(values=cols) + scale_fill_manual(name="Alignments",values=cols)
```

```{r}
nullLessThanOne <- select(NullEvalues, qseqid, sseqid, evalue)
nullLessThanOne <-nullLessThanOne[(nullLessThanOne[,3]< .1),]

relLessThanOne <- select(Evalues, qseqid, sseqid, evalue)
relLessThanOne <-relLessThanOne[(relLessThanOne[,3]< .1),]

pValue = .05/nrow(nullLessThanOne)
pValue

cols <- c("null"="#f04546","relative"="#3591d1")
ggplot() + 
    geom_histogram(data=relLessThanOne, aes(relLessThanOne$evalue, fill="relative") , alpha = .3) +
    geom_histogram(data=nullLessThanOne, aes(nullLessThanOne$evalue, fill="null"), alpha = .3) +
    labs(title="Null Distribution and Alignment of Candida and Relative Sequences for E-values less than .1", x="E-value", y="Count")+
    scale_colour_manual(values=cols) + scale_fill_manual(name="Alignments",values=cols)
```

## Manhattan plots

```{r}
targetSeqs <- c()
relativeSeqs <- c()

for(i in 1:length(relLessThanOne$qseqid)){
  targetSeqs <- c(targetSeqs, as.integer(substr(relLessThanOne$qseqid[i], 8, 14)))
  relativeSeqs <- c(relativeSeqs, as.integer(substr(relLessThanOne$sseqid[i], 6, 10)))
}
relLessThanOne$target <- targetSeqs
relLessThanOne$relative <- relativeSeqs
relLessThanOne
manhattan(relLessThanOne,main = "E-valules less than 0.1 for Relative Sequences", ylim = c(0, 100) ,chr = "relative", bp = "target", p = "evalue", col = c("lightcoral", "lightblue"), ylab = "-log10(evalue)", xlab= "Relative Sequences") 

```


```{r}
positiveAlignments <- read_tsv("outputPositive.txt")
negativeAlignments <- read_tsv("outputNegative.txt")

#Give column names to the null and relative data frames
colnames(positiveAlignments) <- c("qseqid", "sseqid", "pident", "length", "mismatch", "gapopen","qstart", "qend", "sstart", "send", "evalue", "bitscore")
colnames(negativeAlignments) <- c("qseqid", "sseqid", "pident", "length", "mismatch", "gapopen","qstart", "qend", "sstart", "send", "evalue", "bitscore")

#positiveAlignments <- select(positiveAlignments, qseqid, sseqid, evalue)
#positiveAlignments <-positiveAlignments[(positiveAlignments[,3]< .1),]

#negativeAlignments <- select(negativeAlignments, qseqid, sseqid, evalue)
#negativeAlignments <-negativeAlignments[(negativeAlignments[,3]< .1),]


cols <- c("negative"="#f04546","positive"="#3591d1" )
ggplot() + 
    geom_histogram(data=positiveAlignments, aes(positiveAlignments$evalue, fill="positive") , alpha = .3) +
    geom_histogram(data=negativeAlignments, aes(negativeAlignments$evalue, fill="negative"), alpha = .3)+
    labs(title="Evalues for validation species alignment", x="E-value", y="Count")+
    scale_colour_manual(values=cols) + scale_fill_manual(name="Alignments",values=cols)

positiveAlignments$fromSpecies = c("positive")
negativeAlignments$fromSpecies = c("negative")
allResults <- rbind(positiveAlignments, negativeAlignments)


positiveSeqs <- c()
relativeSeqs <- c()

for(i in 1:length(allResults$qseqid)){
  relativeSeqs <- c(relativeSeqs, as.integer(substr(allResults$sseqid[i], 6, 10)))
  positiveSeqs <- c(positiveSeqs, as.integer(allResults$qseqid[i]))
}
allResults$qseqid <- positiveSeqs
allResults$relative <- relativeSeqs
allResults <- arrange(allResults, evalue)
allResults
manhattan(allResults,main = "E-values for Validation Alignments", ylim = c(-2, 10) ,chr = "relative", bp = "qseqid", p = "evalue", col = c("lightcoral"), ylab = "-log10(evalue)", xlab= "Relative Sequences", snp = "fromSpecies", highlight = c("positive")) 

```




